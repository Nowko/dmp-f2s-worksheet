<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DMP — 욕망 해소 자금 산출 워크시트</title>
<style>
  /* ===== Theme ===== */
  :root{
    --bg:#0b1020; --card:#131a33; --muted:#9fb0ff; --text:#e9edff;
    --accent:#7ea7ff; --danger:#ff7e7e; --ok:#7effb6; --border:rgba(255,255,255,.10);
  }
  *{ box-sizing:border-box; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Apple SD Gothic Neo','Noto Sans KR','Malgun Gothic',Arial,sans-serif; }
  body{ margin:0; background:linear-gradient(180deg,#0b1020,#0b1020 50%,#0f1530); color:var(--text); }

  /* ===== Layout ===== */
  .wrap{ max-width:980px; margin:40px auto; padding:0 16px; }
  .title{ font-size:28px; font-weight:800; letter-spacing:-.3px; margin-bottom:4px; }
  .subtitle{ color:var(--muted); margin-bottom:24px; }

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    padding:20px;
    margin-bottom:18px;
    box-shadow:0 8px 24px rgba(0,0,0,.25);
  }

  /* ▶ 두 열 컨테이너: 파란 간격(열 간격) 크게 */
  .grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    column-gap:clamp(48px, 6vw, 72px);   /* ← 오른쪽 라벨과 왼쪽 단위 사이를 넓힘 */
    row-gap:12px;
  }

  /* ▶ 한 행 = 라벨 | 입력 | 단위 : 빨간 간격(라벨–입력–단위) 매우 좁게 */
  .row{
    display:grid;
    grid-template-columns:170px auto auto; /* label | input | unit */
    align-items:center;
    column-gap:4px;                        /* ← 빨간 간격 */
    margin:8px 0;
  }

  /* 라벨은 오른쪽 정렬로 인풋 바로 앞에 붙임(시각상 간격 축소) */
  label{
    color:#c9d4ff; font-size:14px;
    text-align:right; padding-right:2px;
  }

  input[type="number"]{
    width:150px;
    padding:8px 10px;
    border-radius:10px;
    border:1px solid var(--border);
    background:rgba(255,255,255,.05);
    color:var(--text);
    outline:none;
  }
  input::placeholder{ color:#93a3ff; opacity:.6; }

  /* 단위: 인풋에 바짝, 다음 열과는 .grid column-gap으로 분리 */
  .k{
    width:auto; min-width:max-content;
    text-align:left;
    margin-left:2px;                         /* 입력↔단위 아주 살짝만 띄움 */
    white-space:nowrap;                      /* '만원/월' 줄바꿈 방지 */
    opacity:.95;
  }

  .hint{ color:#92a1ff; font-size:12px; }
  .muted{ color:#b7c4ff; opacity:.8; font-size:14px; }
  .section-title{ font-weight:800; margin-bottom:8px; font-size:18px; }
  .pill{
    display:inline-block; padding:4px 10px; border-radius:999px;
    background:rgba(126,167,255,.12); color:var(--accent);
    font-weight:700; font-size:12px; margin-left:8px;
  }

  .result{ font-size:20px; font-weight:800; }
  .result.ok{ color:var(--ok); }
  .result.warn{ color:var(--danger); }

  .btns{ display:flex; gap:10px; flex-wrap:wrap; }
  button{
    background:linear-gradient(180deg,#2a3a7d,#24336b);
    border:1px solid var(--border);
    color:var(--text);
    padding:10px 14px;
    border-radius:12px;
    cursor:pointer;
  }
  button.secondary{ background:rgba(255,255,255,.05); }
  button.danger{ background:linear-gradient(180deg,#7d2a2a,#6b2424); }
  .small{ font-size:13px; }

  .footer{ opacity:.75; font-size:12px; margin-top:8px; }
  .hr{ border-top:1px dashed rgba(255,255,255,.15); margin:14px 0; }
  .note{
    background:rgba(255,255,255,.04);
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 12px;
    font-size:13px;
    color:#cdd6ff;
  }

  /* ===== Responsive ===== */
  @media (max-width:760px){
    .grid{ grid-template-columns:1fr; column-gap:0; row-gap:10px; }
    .row{ grid-template-columns:1fr auto auto; column-gap:6px; }
    input[type="number"]{ width:120px; }
    .k{ margin-left:2px; }
  }
</style>




</head>
<body>
  <div class="wrap">
    <div class="title">〈욕망 해소 자금 산출 워크시트〉</div>
    <div class="subtitle">현금흐름(3장) + 자산구조(4장)를 겹쳐, **안심하고 쓸 수 있는 월 금액(Free to Spend)**을 구합니다.</div>

    <!-- 1단계: 흐름 기반 계산 -->
    <div class="card">
      <div class="section-title">1단계: 현금흐름<span class="pill">F2S</span></div>

      <div class="row">
        <label>세후 소득</label>
        <input type="number" step="0.1" min="0" id="income" placeholder="예: 280" />
        <div class="k">만원/월</div>
      </div>

      <div class="hr"></div>
      <div class="muted"><b>필수 생활비</b></div>

      <div class="grid">
        <div class="row"><label>주거비</label><input type="number" step="0.1" min="0" id="rent" placeholder="예: 70"/><div class="k">만원</div></div>
        <div class="row"><label>교통비</label><input type="number" step="0.1" min="0" id="transport" placeholder="예: 15"/><div class="k">만원</div></div>
        <div class="row"><label>식비(최소 필요)</label><input type="number" step="0.1" min="0" id="food" placeholder="예: 50"/><div class="k">만원</div></div>
        <div class="row"><label>통신비+보험료</label><input type="number" step="0.1" min="0" id="telIns" placeholder="예: 20"/><div class="k">만원</div></div>
        <div class="row"><label>기타 고정비(공과금 등)</label><input type="number" step="0.1" min="0" id="others" placeholder="예: 25"/><div class="k">만원</div></div>
      </div>

      <div class="row">
        <label class="hint">필수 생활비 합계</label>
        <input type="number" id="mustSum" readonly />
        <div class="k">만원</div>
      </div>

      <div class="hr"></div>
      <div class="muted"><b>안전망 지출</b></div>

      <div class="grid">
        <div class="row"><label>비상자금 적립</label><input type="number" step="0.1" min="0" id="emFund" placeholder="예: 30"/><div class="k">만원</div></div>
        <div class="row"><label>부채 상환(원리금)</label><input type="number" step="0.1" min="0" id="debtPay" placeholder="예: 25"/><div class="k">만원</div></div>
        <div class="row"><label>최소 미래 저축</label><input type="number" step="0.1" min="0" id="futureSav" placeholder="예: 0~40"/><div class="k">만원</div></div>
      </div>

      <div class="row">
        <label class="hint">안전망 지출 합계</label>
        <input type="number" id="safetySum" readonly />
        <div class="k">만원</div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label class="result">F2S-흐름 = 세후 소득 − (필수 + 안전망)</label>
        <input class="result" id="flowF2S" readonly />
        <div class="k result">만원/월</div>
      </div>
      <div class="note">※ F2S-흐름은 “기본 한도”입니다. 다음 단계에서 자산 구조로 **보정**합니다.</div>
    </div>

    <!-- 2단계: 자산 구조 보정 -->
    <div class="card">
      <div class="section-title">2단계: 자산 구조 <span class="pill">BS-보정</span></div>

      <div class="muted"><b>현금성 자산 보정</b></div>
      <div class="grid">
        <div class="row"><label>현금성 자산 총액</label><input type="number" step="0.1" min="0" id="cashAssets" placeholder="예: 800"/><div class="k">만원</div></div>
        <div class="row"><label>비상자금 목표(개월)</label><input type="number" step="1" min="3" max="12" id="emMonths" value="6"/><div class="k">개월</div></div>
        <div class="row"><label>현금성 반영률</label><input type="number" step="5" min="0" max="100" id="cashRate" value="50"/><div class="k">%</div></div>
        <div class="row"><label>보호기간(초과 현금 분할기간)</label><input type="number" step="1" min="6" max="24" id="spreadMonths" value="12"/><div class="k">개월</div></div>
      </div>
      <div class="row">
        <label class="hint">적정 비상자금(필수 생활비 합계 × 목표 개월)</label>
        <input type="number" id="needEmergency" readonly />
        <div class="k">만원</div>
      </div>
      <div class="row">
        <label class="hint">초과 현금성 자산 (0 미만이면 0으로 처리)</label>
        <input type="number" id="excessCash" readonly />
        <div class="k">만원</div>
      </div>
      <div class="row">
        <label class="hint">현금성 보정(월 가산) = 초과×반영률÷보호기간</label>
        <input type="number" id="cashAdj" readonly />
        <div class="k">만원/월</div>
      </div>

      <div class="hr"></div>
      <div class="muted"><b>보존성 자산 보정</b></div>
      <div class="grid">
        <div class="row"><label>6개월 내 만기 금액</label><input type="number" step="0.1" min="0" id="preserveMature" placeholder="예: 120"/><div class="k">만원</div></div>
        <div class="row"><label>전환 반영률</label><input type="number" step="5" min="0" max="100" id="preserveRate" value="25"/><div class="k">%</div></div>
        <div class="row"><label>전환 분할기간</label><input type="number" step="1" min="3" max="24" id="preserveSpread" value="6"/><div class="k">개월</div></div>
      </div>
      <div class="row">
        <label class="hint">보존성 보정(월 가산) = 만기×전환율÷분할기간</label>
        <input type="number" id="preserveAdj" readonly />
        <div class="k">만원/월</div>
      </div>

      <div class="hr"></div>
      <div class="muted"><b>부채 보정</b></div>
      <div class="row">
        <label>리파이낸싱/스케줄 변경으로 인한 월 상환 변화분(−는 감소, +는 증가)</label>
        <input type="number" step="0.1" id="debtDelta" value="0" />
        <div class="k">만원/월</div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label class="result">BS-보정 합계 = 현금성(월) + 보존성(월) − 증가한 상환액(+일 때 차감)</label>
        <input class="result" id="bsAdj" readonly />
        <div class="k result">만원/월</div>
      </div>
      <div class="note">※ 성장성 자산은 원칙적으로 보정에 반영하지 않습니다.</div>
    </div>

    <!-- 최종 결과 -->
    <div class="card">
      <div class="section-title">최종 결과</div>
      <div class="row">
        <label class="result">최종 욕망 해소 자금(월) = F2S-흐름 + BS-보정</label>
        <input class="result" id="finalF2S" readonly />
        <div class="k result">만원/월</div>
      </div>
      <div id="message" class="note" style="margin-top:10px;"></div>
      <div class="btns" style="margin-top:14px;">
        <button id="save">로컬 저장</button>
        <button class="secondary" id="load">불러오기</button>
        <button class="secondary" id="reset">초기화</button>
        <button class="secondary" id="exportCsv">CSV 내보내기</button>
      </div>
      <div class="footer">※ 저장은 이 브라우저(로컬스토리지)에만 보관됩니다.</div>
    </div>

    <div class="footer">© DMP — Default Money Plan. 이 도구는 정보 제공 목적이며, 개인 상황에 따라 결과가 달라질 수 있습니다.</div>
  </div>

  <script>
    // 유틸
    const $ = id => document.getElementById(id);
    const num = v => isFinite(parseFloat(v)) ? parseFloat(v) : 0;

    const inputs = [
      'income','rent','transport','food','telIns','others',
      'emFund','debtPay','futureSav',
      'cashAssets','emMonths','cashRate','spreadMonths',
      'preserveMature','preserveRate','preserveSpread','debtDelta'
    ];

    function calc() {
      // 1단계 합계
      const income = num($('income').value);
      const mustSum = num($('rent').value) + num($('transport').value) + num($('food').value) + num($('telIns').value) + num($('others').value);
      $('mustSum').value = round1(mustSum);

      const safetySum = num($('emFund').value) + num($('debtPay').value) + num($('futureSav').value);
      $('safetySum').value = round1(safetySum);

      const flowF2S = income - (mustSum + safetySum);
      $('flowF2S').value = round1(flowF2S);

      // 2단계: 현금성 보정
      const cashAssets = num($('cashAssets').value);
      const emMonths = clamp(num($('emMonths').value), 3, 12);
      $('emMonths').value = emMonths;
      const needEmergency = mustSum * emMonths;
      $('needEmergency').value = round1(needEmergency);

      const excess = Math.max(0, cashAssets - needEmergency);
      $('excessCash').value = round1(excess);

      const cashRate = clamp(num($('cashRate').value), 0, 100);
      $('cashRate').value = cashRate;
      const spreadMonths = clamp(num($('spreadMonths').value), 6, 24);
      $('spreadMonths').value = spreadMonths;

      const cashAdj = (excess * (cashRate/100)) / (spreadMonths || 1);
      $('cashAdj').value = round1(cashAdj);

      // 보존성 보정
      const preserveMature = num($('preserveMature').value);
      const preserveRate = clamp(num($('preserveRate').value), 0, 100);
      $('preserveRate').value = preserveRate;
      const preserveSpread = clamp(num($('preserveSpread').value), 3, 24);
      $('preserveSpread').value = preserveSpread;

      const preserveAdj = (preserveMature * (preserveRate/100)) / (preserveSpread || 1);
      $('preserveAdj').value = round1(preserveAdj);

      // 부채 보정: 증가(+)는 차감, 감소(−)는 가산
      const debtDelta = num($('debtDelta').value);
      const bsAdj = cashAdj + preserveAdj - Math.max(0, debtDelta) + Math.min(0, debtDelta); // +(-감소) = 가산 / +(증가) = 차감
      $('bsAdj').value = round1(bsAdj);

      const final = flowF2S + bsAdj;
      $('finalF2S').value = round1(final);

      // 메시지
      const msg = [];
      if (excess <= 0) msg.push('현금성 자산이 비상자금 목표에 미달하여 현금성 보정 가산이 없습니다.');
      if (preserveMature > 0 && preserveRate > 0) msg.push('보존성 만기금 일부를 기간에 나눠 반영 중입니다.');
      if (debtDelta !== 0) msg.push(`부채 스케줄 변화로 월 ${Math.abs(debtDelta).toFixed(1)}만 원 ${debtDelta>0?'추가 상환(차감)':'감소(가산)'} 반영.`);
      if (msg.length === 0) msg.push('계산이 완료되었습니다. 결과는 만 원 단위로 반올림 표시됩니다.');
      $('message').textContent = msg.join(' ');
    }

    function round1(v){ return (Math.round(v * 10)/10).toFixed(1); }
    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    inputs.forEach(id => $(id).addEventListener('input', calc));
    window.addEventListener('DOMContentLoaded', () => {
      // 기본값(가볍게 예시 세팅)
      $('income').value = 280;
      $('rent').value = 70;
      $('transport').value = 15;
      $('food').value = 50;
      $('telIns').value = 20;
      $('others').value = 25;
      $('emFund').value = 30;
      $('debtPay').value = 25;
      $('futureSav').value = 0;
      $('cashAssets').value = 800;
      $('emMonths').value = 6;
      $('cashRate').value = 50;
      $('spreadMonths').value = 12;
      $('preserveMature').value = 0;
      $('preserveRate').value = 25;
      $('preserveSpread').value = 6;
      $('debtDelta').value = 0;
      calc();
    });

    // 저장/불러오기/초기화/CSV
    $('save').addEventListener('click', ()=> {
      const data = {};
      inputs.concat(['mustSum','safetySum','flowF2S','needEmergency','excessCash','cashAdj','preserveAdj','bsAdj','finalF2S'])
        .forEach(id => data[id] = $(id).value);
      localStorage.setItem('dmp_f2s', JSON.stringify(data));
      alert('이 브라우저에 저장했습니다.');
    });

    $('load').addEventListener('click', ()=> {
      const raw = localStorage.getItem('dmp_f2s');
      if(!raw){ alert('저장된 데이터가 없습니다.'); return; }
      const data = JSON.parse(raw);
      Object.keys(data).forEach(id => { if($(id)) $(id).value = data[id]; });
      calc();
      alert('불러오기 완료.');
    });

    $('reset').addEventListener('click', ()=> {
      if(!confirm('모든 값을 초기화할까요?')) return;
      localStorage.removeItem('dmp_f2s');
      inputs.forEach(id => $(id).value = '');
      $('emMonths').value = 6; $('cashRate').value = 50; $('spreadMonths').value = 12;
      $('preserveRate').value = 25; $('preserveSpread').value = 6; $('debtDelta').value = 0;
      calc();
    });

   $('exportCsv').addEventListener('click', () => {
    const rows = [
      ['항목','값(만원/또는 단위)'],
      ['세후 소득', $('income').value],
      ['필수 합계', $('mustSum').value],
      ['안전망 합계', $('safetySum').value],
      ['F2S-흐름', $('flowF2S').value],
      ['현금성 자산', $('cashAssets').value],
      ['비상자금 목표(개월)', $('emMonths').value],
      ['적정 비상자금', $('needEmergency').value],
      ['초과 현금성', $('excessCash').value],
      ['현금성 보정(월)', $('cashAdj').value],
      ['보존성 만기(6개월내)', $('preserveMature').value],
      ['보존성 전환율(%)', $('preserveRate').value],
      ['보존성 분할기간(개월)', $('preserveSpread').value],
      ['보존성 보정(월)', $('preserveAdj').value],
      ['부채 변화(월)', $('debtDelta').value],
      ['BS-보정 합계(월)', $('bsAdj').value],
      ['최종 F2S(월)', $('finalF2S').value],
    ];

    // 1) 탭으로 구분한 문자열 (CRLF 줄바꿈 권장)
    const tsv = rows.map(r => r.join('\t')).join('\r\n');

    // 2) UTF-16LE 인코딩 (BOM 포함)
    function toUTF16LEWithBOM(str){
      const bom = new Uint8Array([0xFF, 0xFE]); // UTF-16LE BOM
      const buf = new Uint8Array(str.length * 2);
      for (let i = 0; i < str.length; i++) {
        const code = str.charCodeAt(i);
        buf[i*2]   = code & 0xFF;       // low byte
        buf[i*2+1] = (code >> 8) & 0xFF; // high byte
      }
      // BOM + data 결합
      const out = new Uint8Array(bom.length + buf.length);
      out.set(bom, 0);
      out.set(buf, bom.length);
      return out;
    }

    const bytes = toUTF16LEWithBOM(tsv);
    const blob = new Blob([bytes], { type: 'text/tab-separated-values;charset=utf-16le;' });

    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'dmp_f2s_worksheet.tsv';
    a.click();
    URL.revokeObjectURL(a.href);
  });
  </script>
</body>
</html>
